<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.walkfun.db.common.dao.impl.CommonMapper">

    <!-- VersionControl -->
    <resultMap id="versionControl" type="com.walkfun.entity.common.VersionControl">
        <id column="PLATFORM" property="platform"/>
        <result column="VERSION" property="version"/>
        <result column="SUB_VERSION" property="subVersion"/>
        <result column="DESCRIPTION" property="description"/>
    </resultMap>

    <sql id="versionControlTable">
        VC.PLATFORM,
        VC.VERSION,
        VC.SUB_VERSION,
        VC.DESCRIPTION
    </sql>

    <select id="getVersionControl" resultMap="versionControl">
        SELECT
        <include refid="versionControlTable"/>
        FROM VERSION_CONTROL AS VC
        WHERE VC.PLATFORM = #{platform}
    </select>

    <!-- system message -->
    <resultMap id="systemMessageInfo" type="com.walkfun.entity.common.SystemMessage">
        <id column="MESSAGE_ID" property="messageId"/>
        <result column="MESSAGE" property="message"/>
        <result column="RULE" property="rule" />
        <result column="UPDATE_TIME" property="updateTime"/>
    </resultMap>

    <sql id="systemMessageTable">
        MESSAGE_ID,
        MESSAGE,
        RULE,
        UPDATE_TIME
    </sql>

    <select id="getSystemMessageInfo" resultMap="systemMessageInfo">
        SELECT
        <include refid="systemMessageTable"/>
        FROM SYSTEM_MESSAGE
        WHERE UPDATE_TIME > #{lastUpdateTime}
    </select>

    <!-- Feedback -->
    <sql id="feedbackTable">
        DEVICE_ID,
        USER_ID,
        SUGGESTION,
        COMMIT_TIME,
        CONTACT
    </sql>

    <insert id="createFeedback" parameterType="com.walkfun.entity.common.Feedback">
        INSERT INTO FEEDBACK
        (
            DEVICE_ID,
            USER_ID,
            SUGGESTION,
            COMMIT_TIME,
            CONTACT
        )
        VALUES
        (
            #{entity.deviceId},
            #{entity.userId},
            #{entity.suggestion},
            #{entity.commitTime},
            #{entity.contact}
        )
    </insert>

    <!-- down Load info -->
    <resultMap id="downloadStatisticsInfo" type="com.walkfun.entity.common.DownloadStatistics">
        <id column="PLATFORM" property="platform"/>
        <result column="DOWNLOAD_TIME" property="downloadTime"/>
        <result column="VERSION" property="version"/>
    </resultMap>

    <sql id="downloadStatisticsTable">
        PLATFORM,
        DOWNLOAD_TIME,
        VERSION
    </sql>

    <insert id="createDownLoadInfo" parameterType="com.walkfun.entity.common.DownloadStatistics">
        INSERT INTO STATISTICS
        (
            PLATFORM,
            DOWNLOAD_TIME,
            VERSION
        )
        VALUES
        (
            #{entity.platform},
            #{entity.downloadTime},
            #{entity.version}
        )
    </insert>

    <!-- Method Collector -->
    <resultMap id="methodCollectorInfo" type="com.walkfun.entity.common.MethodCollector">
        <id column="METHOD_NAME" property="methodName"/>
        <result column="METHOD_TIMES" property="methodTimes"/>
        <result column="USE_DATE" property="useDate"/>
    </resultMap>

    <sql id="methodCollectorTable">
        METHOD_NAME,
        METHOD_TIMES,
        USE_DATE
    </sql>

    <insert id="createMethodCollector" parameterType="com.walkfun.entity.common.MethodCollector">
        INSERT INTO METHOD_COLLECTOR
        (
            METHOD_NAME,
            METHOD_TIMES,
            USE_DATE
        )
        VALUES
        (
            #{entity.methodName},
            #{entity.methodTimes},
            #{entity.useDate}
        )
    </insert>

    <!-- Recommend App -->
    <resultMap id="recommendAppInfo" type="com.walkfun.entity.common.RecommendApp">
        <id column="APP_ID" property="appId"/>
        <result column="APP_NAME" property="appName"/>
        <result column="APP_DESCRIPTION" property="appDescription"/>
        <result column="APP_PIC_LINK" property="appPicLink"/>
        <result column="UPDATE_TIME" property="updateTime"/>
        <result column="RECOMMEND_STATUS" property="recommendStatus"/>
        <result column="SEQUENCE" property="sequence"/>
        <result column="APP_ADDRESS" property="appAddress"/>
    </resultMap>

    <sql id="recommendAppTable">
        APP_ID,
        APP_NAME,
        APP_DESCRIPTION,
        APP_PIC_LINK,
        UPDATE_TIME,
        RECOMMEND_STATUS,
        SEQUENCE,
        APP_ADDRESS
    </sql>

    <select id="getRecommendApp" resultMap="recommendAppInfo">
        SELECT
        <include refid="recommendAppTable"/>
        FROM RECOMMEND_APP
        WHERE 1 = 1
        <if test="lastUpdateTime != null"><![CDATA[
        AND UPDATE_TIME > #{lastUpdateTime}
        ]]></if>
        ORDER BY SEQUENCE ASC
    </select>

</mapper>
